(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{423:function(e,t,r){"use strict";r.r(t);var a=r(31),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h3",{attrs:{id:"description"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#description"}},[e._v("#")]),e._v(" Description")]),e._v(" "),r("p",[e._v("Là client để gọi sang service authz "),r("RouterLink",{attrs:{to:"/backend/authz-service/service.html"}},[e._v("authz service")])],1),e._v(" "),r("h2",{attrs:{id:"project-structure"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#project-structure"}},[e._v("#")]),e._v(" Project structure")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://s3-ap-southeast-1.amazonaws.com/gemtickets/production/dashboard/8509143c-6441-4877-a17a-5b726f06cf49.png",alt:"image"}})]),e._v(" "),r("p",[r("code",[e._v("authz_client_example/main.go")]),e._v(": Code example khởi tạo client và call 1 số method tới server authz được chỉ định , cần sửa lại "),r("code",[e._v('address = "3.0.95.112:50051"')]),e._v(" thành địa chỉ của mình, nếu chạy service authz ở local, "),r("code",[e._v('address = "localhost:50051"')]),e._v(" ( tùy dưới local có nhiều service grpc hay ko )")]),e._v(" "),r("h2",{attrs:{id:"use"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#use"}},[e._v("#")]),e._v(" Use")]),e._v(" "),r("h3",{attrs:{id:"khoi-tao"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#khoi-tao"}},[e._v("#")]),e._v(" Khởi tạo")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('import\tauthzclient "github.com/es-hs/authzclient"\n\naddress := "localhost:50051"\n\nerr := authzclient.InitAuthClient(address, grpc.WithInsecure(), grpc.WithBlock())\n// close connection khi đóng server\ndefer authzclient.Conn.Close()\n\n// add role authzclient.OWNER_ROLE cho user có ID=2009 vào shop có ID=2011\nr, err := authzclient.AddRoleToDomain(2009, 2011, authzclient.OWNER_ROLE)\nlogrus.Println(time.Since(t1))\nif err != nil {\n  log.Fatalf("err when call authz service %v", err)\n}\nlogrus.Println("Result ", r)\n\n')])])]),r("h3",{attrs:{id:"update-roles-va-permission"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#update-roles-va-permission"}},[e._v("#")]),e._v(" Update Roles và Permission")]),e._v(" "),r("p",[e._v("Sau khi update roles và permission trên "),r("code",[e._v("authz service")]),e._v(" update file "),r("code",[e._v("constant.go")]),e._v(" giống với file "),r("code",[e._v("constant.go")]),e._v(" của version client đang sử dụng")]),e._v(" "),r("h3",{attrs:{id:"khoi-tao-owner-role-cho-user-trong-1-shop-khoi-tao-viec-owner-inherit-role-admin-admin-inherit-tat-ca-cac-roles-con-lai"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#khoi-tao-owner-role-cho-user-trong-1-shop-khoi-tao-viec-owner-inherit-role-admin-admin-inherit-tat-ca-cac-roles-con-lai"}},[e._v("#")]),e._v(" Khởi tạo owner role cho user trong 1 shop, khởi tạo việc owner inherit role admin, admin inherit tất cả các roles còn lại")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// khởi tạo owner role cho user có ID = 2009 trong shop có ID = 2011, khởi tạo việc owner inherit role admin, admin inherit tất cả các quyền còn lại\n\nr5, err := authzclient.GenerateOwnerRole(2009, 2011)\nif err != nil {\n  log.Fatalf("could not greet: %v", err)\n}\n\n')])])]),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// add danh sách các role cho user ID = 2009 trong shop có ID = 2011,\n\nr6, err := authzclient.AddRolesForUserToDomain(2009, 2011, []string{authzclient.ADMIN_ROLE, authzclient.PRODUCT_READ})\nif err != nil {\n  log.Fatalf("could not greet: %v", err)\n}\n')])])]),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('//show danh sách các roles của user có ID = 2009 trong shop có ID = 2011, chỉ các role trực tiếp, ko có role inherit\n\nroles, err = authzclient.GetRolesInDomain(2009, 2011)\nif err != nil {\n  log.Fatalf("could not greet: %v", err)\n}\n')])])]),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('//show danh sách các roles và các inherited roles của user có ID = 2009 trong shop có ID = 2011, bao gồm các role trực tiếp, và có roles inherit\n\nroles, err = authzclient.GetRolesInDomain(2009, 2011)\nif err != nil {\n  log.Fatalf("could not greet: %v", err)\n}\n\n')])])]),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Remove 1 role của user có ID = 2009 trong shop có ID = 2011, chỉ các role trực tiếp, ko có role inherit\n\nr7, err := authzclient.RemoveRoleFromDomain(2009, 2011, authzclient.OWNER_ROLE)\nif err != nil {\n  log.Fatalf("could not greet: %v", err)\n}\n')])])]),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('//Remove 1 danh sách roles của user có ID = 2009 trong shop có ID = 2011, chỉ các role trực tiếp, ko tính role inherit\n\nr8, err := authzclient.RemoveRolesFromDomain(2009, 2011, []string{authzclient.ADMIN_ROLE, authzclient.PRODUCT_READ})\nif err != nil {\n  log.Fatalf("could not greet: %v", err)\n}\n')])])])])}),[],!1,null,null,null);t.default=n.exports}}]);